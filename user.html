<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Fresh Direct - ì „ìƒí’ˆ í†µí•© ì£¼ë¬¸</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        .product-item { transition: all 0.2s ease; }
        .product-item:hover { transform: translateY(-3px); box-shadow: 0 10px 20px -5px rgba(0,0,0,0.1); }
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="pb-24">
    <!-- ìƒë‹¨ ê³ ì • í—¤ë” -->
    <header class="bg-white/90 sticky top-0 z-50 border-b border-slate-200 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col md:flex-row md:items-center justify-between py-4 gap-4">
                <div class="flex items-center gap-3">
                    <h1 class="text-2xl font-black text-indigo-600 tracking-tighter italic">FRESH DIRECT</h1>
                    <span class="text-[10px] font-bold bg-slate-100 text-slate-500 px-2 py-1 rounded">PARTNER ONLY</span>
                </div>
                
                <!-- ê²€ìƒ‰ì°½ -->
                <div class="relative flex-1 max-w-md">
                    <input type="text" id="searchInput" placeholder="700ì—¬ ê°œ ìƒí’ˆ ì¤‘ ê²€ìƒ‰..." 
                        class="w-full bg-slate-100 border-none rounded-2xl py-2.5 pl-11 pr-4 text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition-all">
                    <div class="absolute left-4 top-3 text-slate-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                </div>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
            <div class="flex gap-6 overflow-x-auto no-scrollbar pb-2 text-sm font-bold text-slate-400">
                <button onclick="filterCategory('ì „ì²´')" class="category-btn text-indigo-600 border-b-2 border-indigo-600 pb-2 whitespace-nowrap">ì „ì²´ ìƒí’ˆ</button>
                <button onclick="filterCategory('ì„ ë¬¼ì„¸íŠ¸')" class="category-btn hover:text-slate-600 pb-2 whitespace-nowrap">ğŸ ì„¤ ì„ ë¬¼ì„¸íŠ¸</button>
                <button onclick="filterCategory('ê³¼ì¼')" class="category-btn hover:text-slate-600 pb-2 whitespace-nowrap">ğŸ ì²­ê³¼/ê³¡ë¬¼</button>
                <button onclick="filterCategory('ìˆ˜ì‚°')" class="category-btn hover:text-slate-600 pb-2 whitespace-nowrap">ğŸŒŠ ìˆ˜ì‚°/ê±´ì–´ë¬¼</button>
                <button onclick="filterCategory('ê¸°íƒ€')" class="category-btn hover:text-slate-600 pb-2 whitespace-nowrap">âœ¨ ê¸°íƒ€ ì‹ ì„ ì‹í’ˆ</button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- ì•Œë¦¼ë°” -->
        <div class="bg-indigo-600 rounded-3xl p-6 mb-8 text-white flex flex-col md:flex-row justify-between items-center gap-4 shadow-lg shadow-indigo-100">
            <div>
                <h2 class="text-xl font-black italic">DATABASE UPDATED</h2>
                <p class="text-indigo-100 text-xs opacity-80 mt-1">ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë‚´ 700ì—¬ ê°œ ì „ ìƒí’ˆ ì •ë³´ê°€ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            </div>
            <div class="flex gap-2">
                <span class="text-[10px] bg-white/20 px-3 py-1.5 rounded-full font-bold">ì˜¤ì „ 09:30 ë°œì£¼ë§ˆê°</span>
                <span class="text-[10px] bg-white/20 px-3 py-1.5 rounded-full font-bold">ì „êµ­ ìµì¼ë°°ì†¡</span>
            </div>
        </div>

        <!-- ìƒí’ˆ ì¹´ìš´íŠ¸ ë° ë¡œë”© í‘œì‹œ -->
        <div id="statusInfo" class="mb-6 flex items-center justify-between text-xs font-bold text-slate-500 px-2">
            <span id="productCount">ë°ì´í„° ë¡œë”© ì¤‘...</span>
        </div>

        <!-- ìƒí’ˆ ê·¸ë¦¬ë“œ -->
        <div id="productGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
            <!-- ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤ -->
            <div class="skeleton h-64 rounded-3xl"></div>
            <div class="skeleton h-64 rounded-3xl"></div>
            <div class="skeleton h-64 rounded-3xl"></div>
            <div class="skeleton h-64 rounded-3xl"></div>
            <div class="skeleton h-64 rounded-3xl"></div>
        </div>
    </main>

    <script>
        // êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ JSON ë³€í™˜ URL (ê³µê°œ ìƒíƒœì—¬ì•¼ í•¨)
        const SPREADSHEET_ID = '1W94T7cHWt2ZDsXYmWLixcEDE3qxGGD0-GFg1j9dA1II';
        const GID = '0';
        const CSV_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${GID}`;

        let allProducts = [];
        let currentFilter = 'ì „ì²´';

        // 1. ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (CSV íŒŒì‹±)
        async function fetchProducts() {
            try {
                const response = await fetch(CSV_URL);
                const data = await response.text();
                
                // ê°„ë‹¨í•œ CSV íŒŒì„œ (ì¤„ë°”ê¿ˆê³¼ ì½¤ë§ˆ ê¸°ì¤€)
                const rows = data.split('\n').slice(1); // í—¤ë” ì œì™¸
                
                allProducts = rows.map(row => {
                    const cols = row.split(',');
                    // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì—´ ìˆœì„œì— ë§ì¶° ë§¤í•‘ (ìˆœë²ˆ, ìƒí’ˆ, ë””ìì¸íŒŒì¼, í’ˆëª…, ê³µê¸‰ê°€ ë“±)
                    // í˜„ì¬ ì‹œíŠ¸ êµ¬ì¡°ì— ìµœì í™”: 4ë²ˆì§¸ ì—´(í’ˆëª…), 5ë²ˆì§¸ ì—´(ê³µê¸‰ê°€) ë“±
                    const name = cols[3]?.replace(/"/g, '') || cols[1]?.replace(/"/g, '') || "ìƒí’ˆëª… ì •ë³´ ì—†ìŒ";
                    const price = cols[4] ? parseInt(cols[4].replace(/[^0-9]/g, '')).toLocaleString() : "ë³„ë„ë¬¸ì˜";
                    const desc = cols[10]?.replace(/"/g, '') || "";
                    const category = inferCategory(name, desc);
                    
                    return { name, price, desc, category, raw: row };
                }).filter(p => p.name !== "ìƒí’ˆëª… ì •ë³´ ì—†ìŒ" && p.name.length > 2);

                renderProducts(allProducts);
                document.getElementById('productCount').innerText = `ì´ ${allProducts.length}ê°œì˜ ìƒí’ˆì´ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`;
            } catch (error) {
                console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
                document.getElementById('productGrid').innerHTML = '<p class="col-span-full text-center py-20 text-slate-400 font-bold">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ê³µìœ  ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
            }
        }

        // ì¹´í…Œê³ ë¦¬ ì¶”ë¡  ë¡œì§
        function inferCategory(name, desc) {
            if (name.includes('ì„¸íŠ¸') || name.includes('ì„ ë¬¼')) return 'ì„ ë¬¼ì„¸íŠ¸';
            if (name.includes('ì „ë³µ') || name.includes('êµ´ë¹„') || name.includes('ì—°ì–´') || name.includes('ê°ˆì¹˜')) return 'ìˆ˜ì‚°';
            if (name.includes('ì‚¬ê³¼') || name.includes('ë°°') || name.includes('ë§ê³ ') || name.includes('ë”¸ê¸°') || name.includes('ì²´ë¦¬')) return 'ê³¼ì¼';
            return 'ê¸°íƒ€';
        }

        // 2. ìƒí’ˆ ë Œë”ë§
        function renderProducts(products) {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = products.map(p => `
                <div class="bg-white rounded-3xl p-4 border border-slate-100 product-item flex flex-col justify-between">
                    <div>
                        <div class="aspect-square bg-slate-50 rounded-2xl mb-4 flex items-center justify-center text-3xl opacity-40">
                            ${getEmoji(p.category)}
                        </div>
                        <span class="text-[9px] font-black px-2 py-1 rounded-full bg-slate-100 text-slate-400 uppercase tracking-tighter italic">${p.category}</span>
                        <h3 class="mt-2 font-bold text-slate-800 text-sm leading-tight h-10 overflow-hidden line-clamp-2">${p.name}</h3>
                    </div>
                    <div class="mt-4 flex items-baseline gap-1">
                        <span class="text-indigo-600 font-black text-lg">${p.price}</span>
                        <span class="text-[10px] font-bold text-indigo-600">ì›</span>
                    </div>
                </div>
            `).join('');
        }

        function getEmoji(cat) {
            const map = { 'ì„ ë¬¼ì„¸íŠ¸': 'ğŸ', 'ìˆ˜ì‚°': 'ğŸŒŠ', 'ê³¼ì¼': 'ğŸ', 'ê¸°íƒ€': 'ğŸ“¦' };
            return map[cat] || 'âœ¨';
        }

        // 3. í•„í„° ë° ê²€ìƒ‰ ê¸°ëŠ¥
        function filterCategory(cat) {
            currentFilter = cat;
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                btn.classList.add('text-slate-400');
                if (btn.innerText.includes(cat)) {
                    btn.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
                    btn.classList.remove('text-slate-400');
                }
            });

            applyFilter();
        }

        function applyFilter() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            const filtered = allProducts.filter(p => {
                const matchesCat = (currentFilter === 'ì „ì²´' || p.category === currentFilter);
                const matchesSearch = p.name.toLowerCase().includes(searchTerm);
                return matchesCat && matchesSearch;
            });

            renderProducts(filtered);
            document.getElementById('productCount').innerText = `${filtered.length}ê°œì˜ ìƒí’ˆì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤.`;
        }

        // ê²€ìƒ‰ì°½ ì´ë²¤íŠ¸
        document.getElementById('searchInput').addEventListener('input', applyFilter);

        // ì´ˆê¸° ì‹¤í–‰
        window.onload = fetchProducts;
    </script>
</body>
</html>